min_version = "2025.11.3"
experimental_monorepo_root = true

[settings]
experimental = true

[env]
CARGO_HOME = "{{env.HOME}}/.cargo"
RUSTUP_HOME = "{{env.HOME}}/.rustup"
PYO3_USE_ABI3_FORWARD_COMPATIBILITY = "1"
UV_LINK_MODE = "copy"
BASELINE_BROWSER_MAPPING_IGNORE_OLD_DATA = "true"
BROWSERSLIST_IGNORE_OLD_DATA = "true"

[tools]
biome = "latest"
bun = "latest"
node = "lts"
python = "latest"
rust = "latest"
uv = "latest"

[tasks.setup]
run = [
	"mise run //backend:install",
	"mise run //docsite:install",
	"mise run //frontend:install",
	"mise run //ugoite-cli:install",
	"mise run //ugoite-core:install",
	"mise run //e2e:install",
]

[tasks.dev]
depends = ["//backend:dev", "//frontend:dev", "//docsite:dev"]

[tasks."dev:backend"]
description = "Run backend dev server only"
depends = ["//backend:dev"]

[tasks."dev:frontend"]
description = "Run frontend dev server only"
depends = ["//frontend:dev"]

[tasks."dev:docsite"]
description = "Run docsite dev server only"
depends = ["//docsite:dev"]

[tasks.test]
depends = ["//backend:test", "//frontend:test", "//ugoite-cli:test", "//ugoite-core:test", "test:docs"]
description = "Run tests for all packages (ugoite-core, backend, frontend, ugoite-cli)"

[tasks."test:docs"]
description = "Check consistency between documentation and implementation"
run = "uv run --with pytest --with pyyaml --with bashlex pytest docs/tests -v"

[tasks.e2e]
description = "Run E2E tests with backend and frontend servers"
run = "bash e2e/scripts/run-e2e.sh full"

[tasks.screenshot]
description = "Capture UI page screenshots for docsite"
run = "bash e2e/scripts/run-e2e.sh screenshot"

[tasks."e2e:smoke"]
description = "Run only smoke E2E tests (fast verification)"
run = "bash e2e/scripts/run-e2e.sh smoke"

[tasks."e2e:entries"]
description = "Run entries E2E tests"
run = "bash e2e/scripts/run-e2e.sh entries"