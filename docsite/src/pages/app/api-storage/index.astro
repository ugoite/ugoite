---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import TerminalCommand from "../../../components/TerminalCommand.astro";

const toc = [
  { id: "overview", title: "Overview" },
  { id: "architecture", title: "Architecture" },
  { id: "setup", title: "Setup" },
  { id: "explore", title: "Explore" },
];
---

<BaseLayout title="API & Block Storage | Ugoite" description="Serverless API and OpenDAL block storage architecture." toc={toc}
  related={[{ href: "/app", label: "App Overview" }, { href: "/app/api-storage/apis", label: "API Catalog" }, { href: "/app/api-storage/data-model", label: "Data Model" }]}>

  <section id="overview" class="doc-card-hero">
    <div style="position: relative; z-index: 1;">
      <span class="doc-pill">API + Block Storage</span>
      <h1 style="font-size: 2rem; font-weight: 800; margin-top: 0.75rem; letter-spacing: -0.02em;">
        Serverless-Ready API with Portable Storage
      </h1>
      <p style="color: var(--doc-muted); margin-top: 0.5rem; max-width: 40rem; line-height: 1.6;">
        The API is a thin FastAPI adapter with zero business logic. All data operations are delegated to ugoite-core, which uses OpenDAL for storage abstraction across S3, local filesystem, and compatible object stores.
      </p>
    </div>
  </section>

  <!-- Detailed architecture -->
  <section id="architecture" class="doc-card">
    <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">Detailed Architecture</h2>
    <div class="doc-diagram">
      <div class="doc-arch-flow">
        <div class="doc-arch-row">
          <div class="doc-arch-node">
            <div class="doc-arch-node-icon">üåê</div>
            <div class="doc-arch-node-title">Client</div>
            <div class="doc-arch-node-desc">Browser / CLI / MCP</div>
          </div>
        </div>

        <div class="doc-arch-connector">
          <div class="doc-arch-connector-line"></div>
          <span>HTTP / REST</span>
          <div class="doc-arch-connector-line"></div>
        </div>

        <div class="doc-arch-row">
          <div class="doc-arch-node">
            <div class="doc-arch-node-icon">‚ö°</div>
            <div class="doc-arch-node-title">FastAPI</div>
            <div class="doc-arch-node-desc">Protocol boundary ‚Äî no business logic</div>
          </div>
        </div>

        <div class="doc-arch-connector">
          <div class="doc-arch-connector-line"></div>
          <span>calls core functions</span>
          <div class="doc-arch-connector-line"></div>
        </div>

        <div class="doc-arch-row">
          <div class="doc-arch-node" style="border-color: var(--doc-accent);">
            <div class="doc-arch-node-icon">üß¨</div>
            <div class="doc-arch-node-title">ugoite-core</div>
            <div class="doc-arch-node-desc">Business logic + validation</div>
          </div>
        </div>

        <div class="doc-arch-connector">
          <div class="doc-arch-connector-line"></div>
          <span>storage I/O</span>
          <div class="doc-arch-connector-line"></div>
        </div>

        <div class="doc-arch-row">
          <div class="doc-arch-node">
            <div class="doc-arch-node-icon">üì¶</div>
            <div class="doc-arch-node-title">OpenDAL</div>
            <div class="doc-arch-node-desc">Storage abstraction</div>
          </div>
          <div class="doc-arch-node">
            <div class="doc-arch-node-icon">‚òÅÔ∏è</div>
            <div class="doc-arch-node-title">Block Storage</div>
            <div class="doc-arch-node-desc">S3 / local / compatible</div>
          </div>
          <div class="doc-arch-node">
            <div class="doc-arch-node-icon">üìÅ</div>
            <div class="doc-arch-node-title">Space Directory</div>
            <div class="doc-arch-node-desc">Portable data layout</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Setup -->
  <section id="setup" class="doc-card">
    <h2 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">Setup</h2>
    <div style="display: grid; gap: 0.75rem;">
      <div>
        <p style="font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.375rem;">1. Install all dependencies</p>
        <TerminalCommand command="mise run setup" />
      </div>
      <div>
        <p style="font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.375rem;">2. Start the development servers</p>
        <TerminalCommand command="mise run dev" />
      </div>
      <div>
        <p style="font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.375rem;">3. Set the storage root (optional)</p>
        <TerminalCommand command="export UGOITE_ROOT=/path/to/spaces" />
      </div>
      <div>
        <p style="font-size: 0.8125rem; font-weight: 600; margin-bottom: 0.375rem;">4. Verify the API</p>
        <TerminalCommand command="curl http://localhost:8000/spaces" />
      </div>
    </div>
  </section>

  <!-- Explore -->
  <section id="explore">
    <div class="doc-grid">
      <a href="/app/api-storage/apis" class="doc-card doc-card-hover" style="text-decoration: none; color: inherit;">
        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üì°</div>
        <h3 style="font-size: 1rem; font-weight: 700;">API Catalog</h3>
        <p style="font-size: 0.8125rem; color: var(--doc-muted); margin-top: 0.375rem;">Browse all endpoints by domain with interactive curl console.</p>
      </a>
      <a href="/app/api-storage/data-model" class="doc-card doc-card-hover" style="text-decoration: none; color: inherit;">
        <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üìÅ</div>
        <h3 style="font-size: 1rem; font-weight: 700;">Data Model</h3>
        <p style="font-size: 0.8125rem; color: var(--doc-muted); margin-top: 0.375rem;">Space directory structure and file schema visual reference.</p>
      </a>
    </div>
  </section>
</BaseLayout>
