---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getRequirementGroups } from "../../lib/spec-data";

const groups = await getRequirementGroups();
const toc = groups.map((g) => ({ id: g.setId.toLowerCase(), title: g.setId }));
const totalReqs = groups.reduce((sum, g) => sum + g.requirements.length, 0);
---

<BaseLayout title="Requirements | Ugoite" description="Grouped requirement sets from docs/spec/requirements." toc={toc}
  related={[{ href: "/design/policies", label: "Policies" }, { href: "/design/features", label: "Features" }]}>

  <section class="doc-card-hero">
    <div style="position: relative; z-index: 1;">
      <span class="doc-pill">docs/spec/requirements</span>
      <h1 style="font-size: 2rem; font-weight: 800; margin-top: 0.75rem; letter-spacing: -0.02em;">Requirements</h1>
      <p style="color: var(--doc-muted); margin-top: 0.5rem; line-height: 1.6;">
        {groups.length} requirement sets containing {totalReqs} individual requirements, organized by domain.
      </p>
    </div>
  </section>

  {groups.map((group) => (
    <section id={group.setId.toLowerCase()} class="doc-card">
      <div style="display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 0.75rem; margin-bottom: 1rem;">
        <div>
          <span class="doc-pill">{group.setId}</span>
          <p style="font-size: 0.8125rem; color: var(--doc-muted); margin-top: 0.375rem;">{group.scope}</p>
        </div>
        <span style="font-size: 0.75rem; color: var(--doc-muted);">{group.requirements.length} requirements</span>
      </div>
      <div class="doc-table-wrap">
        <table class="doc-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Priority</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {group.requirements.map((r) => (
              <tr>
                <td><code style="font-size: 0.75rem; background: var(--doc-bg-subtle); padding: 0.125rem 0.375rem; border-radius: var(--doc-radius-sm);">{r.id}</code></td>
                <td>{r.title}</td>
                <td>
                  {r.priority === "must" ? (
                    <span class="doc-pill-success doc-pill">{r.priority}</span>
                  ) : r.priority === "should" ? (
                    <span class="doc-pill-warning doc-pill">{r.priority}</span>
                  ) : (
                    <span class="doc-pill doc-pill-outline">{r.priority ?? "-"}</span>
                  )}
                </td>
                <td>
                  {r.status === "implemented" ? (
                    <span class="doc-pill doc-pill-success">{r.status}</span>
                  ) : (
                    <span class="doc-pill doc-pill-outline">{r.status ?? "-"}</span>
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </section>
  ))}
</BaseLayout>
