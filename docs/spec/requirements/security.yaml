category: Security
prefix: REQ-SEC
requirements:
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-001
  title: Localhost Binding
  description: 'API binds to 127.0.0.1 only by default. Remote access requires

    explicit UGOITE_ALLOW_REMOTE=true environment variable.

    '
  related_spec:
  - security/overview.md
  priority: high
  status: implemented
  tests:
    pytest:
    - file: backend/tests/test_api.py
      tests:
      - test_middleware_blocks_remote_clients
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-002
  title: Security Headers
  description: 'Set security-related HTTP headers (X-Content-Type-Options,

    X-Frame-Options, etc.).

    '
  related_spec:
  - security/overview.md
  priority: medium
  status: implemented
  tests:
    pytest:
    - file: backend/tests/test_api.py
      tests:
      - test_middleware_headers
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-003
  title: Mandatory User Authentication
  description: 'All API/MCP access MUST require authenticated user identity, including

    localhost mode. Network binding and remote exposure flags MUST NOT disable

    authentication enforcement.

    '
  related_spec:
  - security/overview.md
  - api/rest.md#authentication
  - api/mcp.md#security-model
  priority: high
  status: implemented
  tests:
    pytest:
    - file: backend/tests/test_auth.py
      tests:
      - test_auth_rejects_unauthenticated_localhost_requests
      - test_auth_rejects_unauthenticated_remote_requests
      - test_auth_rejects_invalid_bearer_signature
      - test_auth_rejects_expired_bearer_token
      - test_auth_rejects_revoked_api_key
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-004
  title: Passkey-First Authentication and OAuth2 Linking
  description: 'Primary user authentication MUST be passkey/WebAuthn with passwordless

    login. Optional external OAuth2 identity linking MAY be enabled and MAY

    auto-provision new User records.

    '
  related_spec:
  - security/overview.md#authentication-future
  - api/rest.md#auth--user-management-milestone-4-phase-0-baseline
  - stories/experimental.yaml
  priority: high
  status: planned
  tests:
    pytest:
    - file: backend/tests/test_auth_passkeys_oauth2_linking.py
      tests:
      - test_passkey_primary_authentication__planned
      - test_oauth2_account_linking__planned
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-005
  title: Admin Bootstrap and Recovery Controls
  description: 'Admin onboarding MUST support one-time invite-token enrollment for

    initial WebAuthn registration. Admin UI capabilities MUST include forced

    credential reset and backup-code issuance, with audit visibility.

    '
  related_spec:
  - security/overview.md#recovery--administration
  - api/rest.md#auth--user-management-milestone-4-phase-0-baseline
  priority: high
  status: planned
  tests:
    pytest:
    - file: backend/tests/test_auth_admin_recovery.py
      tests:
      - test_admin_invite_token_bootstrap_enrollment__planned
      - test_admin_forced_reset__planned
      - test_admin_backup_code_issuance__planned
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-006
  title: Space-Scoped Authorization and Form ACL
  description: 'Identity MUST be scoped to each space. Space creator becomes initial

    admin and can delegate admins. Forms MUST support user/group read-write

    restrictions, and materialized views MUST inherit source-Form policy.

    '
  related_spec:
  - data-model/overview.md#form-level-access-control-metadata
  - data-model/sql-sessions.md#materialized-views
  - stories/experimental.yaml
  priority: high
  status: planned
  tests:
    pytest:
    - file: backend/tests/test_forms_acl.py
      tests:
      - test_form_acl_denies_unauthorized_read_access
      - test_form_acl_denies_unauthorized_write_access
      - test_form_acl_allows_group_principal_access
      - test_materialized_view_inherits_form_acl_policies
    e2e:
    - file: e2e/forms-acl.test.ts
      tests:
      - Enforces Form ACL Read/Write Restrictions for Space Members
      - Enforces Materialized View Policy Intersection with Form ACL
