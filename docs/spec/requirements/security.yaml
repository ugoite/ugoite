category: Security
prefix: REQ-SEC
requirements:
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-001
  title: Localhost Binding
  description: 'API binds to 127.0.0.1 only by default. Remote access requires

    explicit UGOITE_ALLOW_REMOTE=true environment variable.

    '
  related_spec:
  - security/overview.md
  priority: high
  status: implemented
  tests:
    pytest:
    - file: backend/tests/test_api.py
      tests:
      - test_middleware_blocks_remote_clients
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-002
  title: Security Headers
  description: 'Set security-related HTTP headers (X-Content-Type-Options,

    X-Frame-Options, etc.).

    '
  related_spec:
  - security/overview.md
  priority: medium
  status: implemented
  tests:
    pytest:
    - file: backend/tests/test_api.py
      tests:
      - test_middleware_headers
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-003
  title: Mandatory User Authentication
  description: 'All API/MCP access MUST require authenticated user identity, including

    localhost mode. Network binding and remote exposure flags MUST NOT disable

    authentication enforcement.

    '
  related_spec:
  - security/overview.md
  - api/rest.md#authentication
  - api/mcp.md#security-model
  priority: high
  status: implemented
  tests:
    pytest:
    - file: backend/tests/test_auth.py
      tests:
      - test_auth_rejects_unauthenticated_localhost_requests
      - test_auth_rejects_unauthenticated_remote_requests
      - test_auth_rejects_malformed_signed_token_segments
      - test_auth_rejects_invalid_bearer_signature
      - test_auth_rejects_expired_bearer_token
      - test_auth_rejects_revoked_api_key
    - file: ugoite-core/tests/test_auth.py
      tests:
      - test_bootstrap_warning_redacts_token_value
    - file: ugoite-core/tests/test_auth_overview_consistency.py
      tests:
      - test_auth_overview_matches_security_yaml_contract
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-004
  title: Passkey-First Authentication and OAuth2 Linking
  description: 'Primary user authentication MUST be passkey/WebAuthn with passwordless

    login. Optional external OAuth2 identity linking MAY be enabled and MAY

    auto-provision new User records.

    '
  related_spec:
  - security/overview.md#authentication-future
  - api/rest.md#auth--user-management-milestone-4-phase-0-baseline
  - stories/experimental.yaml
  priority: high
  status: planned
  tests:
    pytest:
    - file: backend/tests/test_auth_passkeys_oauth2_linking.py
      tests:
      - test_passkey_primary_authentication__planned
      - test_oauth2_account_linking__planned
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-005
  title: Admin Bootstrap and Recovery Controls
  description: 'Admin onboarding MUST support one-time invite-token enrollment for

    initial WebAuthn registration. Admin UI capabilities MUST include forced

    credential reset and backup-code issuance, with audit visibility.

    '
  related_spec:
  - security/overview.md#recovery--administration
  - api/rest.md#auth--user-management-milestone-4-phase-0-baseline
  priority: high
  status: planned
  tests:
    pytest:
    - file: backend/tests/test_auth_admin_recovery.py
      tests:
      - test_admin_invite_token_bootstrap_enrollment__planned
      - test_admin_forced_reset__planned
      - test_admin_backup_code_issuance__planned
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-006
  title: Space-Scoped Authorization and Form ACL
  description: 'Identity MUST be scoped to each space. Space creator becomes initial

    admin and can delegate admins. Forms MUST support user/group read-write

    restrictions, and materialized views MUST inherit source-Form policy.

    '
  related_spec:
  - data-model/overview.md#form-level-access-control-metadata
  - data-model/sql-sessions.md#materialized-views
  - stories/experimental.yaml
  priority: high
  status: implemented
  tests:
    pytest:
    - file: backend/tests/test_forms_acl.py
      tests:
      - test_form_acl_denies_unauthorized_read_access
      - test_form_acl_denies_unauthorized_write_access
      - test_form_acl_allows_group_principal_access
      - test_materialized_view_inherits_form_acl_policies
    e2e:
    - file: e2e/forms-acl.test.ts
      tests:
      - Enforces Form ACL Read/Write Restrictions for Space Members
      - Enforces Materialized View Policy Intersection with Form ACL
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-007
  title: Space Membership Lifecycle and Invitation Collaboration
  description: 'Each space MUST support explicit member lifecycle states (`invited`,

    `active`, `revoked`) with invitation issuance, acceptance, role changes,

    and revocation controls. Membership updates MUST be concurrency-safe and

    must drive effective authorization outcomes for the authenticated user.

    '
  related_spec:
  - stories/experimental.yaml
  - api/rest.md#spaces
  priority: high
  status: implemented
  tests:
    pytest:
    - file: backend/tests/test_space_members.py
      tests:
      - test_space_member_invite_and_accept_transitions_to_active
      - test_space_member_role_change_controls_admin_permissions
      - test_space_member_revoke_removes_access
    e2e:
    - file: e2e/space-membership.test.ts
      tests:
      - "REQ-SEC-007: invitation lifecycle invite/accept/revoke"
      - "REQ-SEC-007: role changes switch admin privileges"
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-008
  title: Security Audit Logging and Attribution
  description: 'Security-relevant events MUST be recorded with actor attribution,

    action, outcome, target, and request metadata. Audit logs MUST support

    paginated retrieval with filtering and MUST include tamper-evident integrity

    checks.

    '
  related_spec:
  - security/overview.md
  - api/rest.md#authentication
  priority: high
  status: implemented
  tests:
    pytest:
    - file: backend/tests/test_audit.py
      tests:
      - test_audit_lists_data_mutation_events
      - test_audit_logs_authorization_denial
    - file: ugoite-core/tests/test_audit.py
      tests:
      - test_audit_appends_and_lists_events
      - test_audit_detects_chain_tampering
- set_id: REQCAT-SECURITY
  source_file: requirements/security.yaml
  scope: Security controls, integrity protections, and isolation requirements.
  linked_policies:
  - POL-003
  - POL-004
  - POL-010
  - POL-011
  linked_specifications:
  - SPEC-SECURITY-OVERVIEW
  - SPEC-SECURITY-SANDBOX
  - SPEC-ARCH-INTERFACE
  id: REQ-SEC-009
  title: Service Accounts and Scoped API Keys for Automation
  description: 'Automation access MUST be provided by explicit service accounts

    with least-privilege action scopes. API keys MUST support create/list/revoke/rotate

    workflows with one-time secret reveal, and revoked keys MUST fail authentication

    immediately across REST/MCP channels. Key usage MUST be audit-visible.

    '
  related_spec:
  - security/overview.md
  - api/rest.md#authentication
  - api/mcp.md#security-model
  priority: high
  status: implemented
  tests:
    pytest:
    - file: ugoite-core/tests/test_service_accounts.py
      tests:
      - test_service_account_scopes_are_enforced
      - test_service_account_revoked_key_is_rejected
      - test_service_account_key_usage_is_audit_logged
    - file: backend/tests/test_service_accounts.py
      tests:
      - test_service_account_scopes_and_revocation_flow
    - file: ugoite-cli/tests/test_cli_endpoint_routing.py
      tests:
      - test_space_service_account_create_routes_to_backend
